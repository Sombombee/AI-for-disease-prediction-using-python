# -*- coding: utf-8 -*-
"""Copy of Untitled0.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1PIImCMwSZ0tz_-eESc-egRHsFOr0MR1e
"""

!pip install opendatasets

import opendatasets as od
od.download("https://www.kaggle.com/datasets/meirnizri/covid19-dataset?resource=download")

# Core libraries
import numpy as np
import pandas as pd

# Data scaling
from sklearn.preprocessing import MinMaxScaler



# Load dataset
data = pd.read_csv("/content/covid19-dataset/Covid Data.csv")

print(data.head())
print(data.info())

# Create binary target variable
# If DATE_DIED is not '9999-99-99', patient died
data['DEATH'] = np.where(data['DATE_DIED'] != '9999-99-99', 1, 0)

# Drop DATE_DIED column (not needed anymore)
data.drop('DATE_DIED', axis=1, inplace=True)

# Replace invalid values with NaN
data.replace([97, 98, 99], np.nan, inplace=True)

# Fill missing values with column median
data.fillna(data.median(), inplace=True)

# Separate input features and output label
X = data.drop('DEATH', axis=1)
y = data['DEATH']

# Training the model using Random forest traning method
from sklearn.model_selection import train_test_split

X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.2, random_state=42
)
from sklearn.ensemble import RandomForestClassifier

model = RandomForestClassifier(
    n_estimators=100,
    random_state=42
)

model.fit(X_train, y_train)

# Example patient
new_patient = pd.DataFrame({
    'USMER': [2],
    'MEDICAL_UNIT': [1],
    'SEX': [1],
    'PATIENT_TYPE': [1],
    'INTUBED': [2],
    'PNEUMONIA': [1],
    'AGE': [65],
    'PREGNANT': [2],
    'DIABETES': [1],
    'COPD': [2],
    'ASTHMA': [2],
    'INMSUPR': [2],
    'HIPERTENSION': [1],
    'OTHER_DISEASE': [2],
    'CARDIOVASCULAR': [2],
    'OBESITY': [2],
    'RENAL_CHRONIC': [2],
    'TOBACCO': [2],
    'CLASIFFICATION_FINAL': [3],
    'ICU': [2]
})

# Predict outcome
prediction = model.predict(new_patient)

# Output result
if prediction[0] == 1:
    print("Prediction: High risk of death")
else:
    print("Prediction: Likely to survive")